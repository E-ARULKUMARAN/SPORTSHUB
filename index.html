<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SportsHub - Online Sports Store</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* ---------- BASE STYLES ---------- */
    html, body {
      height: 100%;
      margin: 0;
      display: flex;
      flex-direction: column;
      background: linear-gradient(180deg, #f4f7fb 0%, #e8eef9 100%);
      color: #222;
      font-family: 'Segoe UI', sans-serif;
      scroll-behavior: smooth;
      transition: background 0.5s ease;
    }
    body.dark {
      background: radial-gradient(circle at top, #121212, #000);
      color: #eee;
    }

    /* ---------- HEADER ---------- */
    header.topbar {
      background: linear-gradient(135deg, #0072ff, #00c6ff);
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 25px;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      animation: fadeInDown 1s ease;
    }

    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .logo {
      font-size: 24px;
      font-weight: bold;
      letter-spacing: 0.5px;
      text-shadow: 0 2px 5px  black;
      animation: pulseLogo 3s infinite ease-in-out;
    }

    @keyframes pulseLogo {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .search input {
      padding: 8px 12px;
      border-radius: 25px;
      border: none;
      width: 250px;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    .search input:focus {
      outline: none;
      box-shadow: 0 0 10px #00c6ff;
      transform: scale(1.05);
    }

    .right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    /* ---------- MENU ---------- */
    .menu {
      background: rgba(255,255,255,0.7);
      backdrop-filter: blur(10px);
      padding: 12px;
      display: flex;
      justify-content: center;
      gap: 25px;
      font-weight: bold;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.5s ease;
      animation: fadeIn 1s ease;
    }
    .menu.hidden { display: none; }
    .menu a {
      color: #0072ff;
      text-decoration: none;
      transition: color 0.3s, transform 0.3s;
      position: relative;
    }
    .menu a::after {
      content: '';
      position: absolute;
      left: 0; bottom: -5px;
      width: 100%; height: 2px;
      background: #00c6ff;
      transform: scaleX(0);
      transition: transform 0.3s ease;
      transform-origin: right;
    }
    .menu a:hover::after { transform: scaleX(1); transform-origin: left; }
    .menu a:hover { color: #00aaff; transform: translateY(-2px); }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ---------- CATEGORY CHIPS ---------- */
    #categories { margin: 30px; text-align: center; animation: fadeInUp 1s ease; }
    h2 { text-align: center; font-size: 26px; margin-bottom: 15px; }
    .catlist {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 15px;
    }
    .chip {
      background: linear-gradient(135deg, #0072ff, #00c6ff);
      color: white;
      padding: 10px 18px;
      border-radius: 30px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .chip:hover, .chip.active {
      background: linear-gradient(135deg, #00c6ff, #0072ff);
      transform: scale(1.1);
      box-shadow: 0 6px 15px rgba(0,0,0,0.2);
    }

    /* ---------- ITEM GRID ---------- */
    #featured { margin: 40px; flex-grow: 1; animation: fadeInUp 1.2s ease; }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
      gap: 20px;
      margin-top: 25px;
    }
    .item-card {
      background: rgba(255,255,255,0.8);
      backdrop-filter: blur(10px);
      border-radius: 18px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      text-align: center;
      padding: 15px;
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
      transform: scale(0.95);
      animation: popIn 0.8s ease forwards;
    }

    @keyframes popIn {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }

    .item-card:hover {
      transform: translateY(-8px) scale(1.03);
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }

    .item-card img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 12px;
      transition: transform 0.4s ease;
    }
    .item-card:hover img {
      transform: scale(1.1);
    }

    .item-card h3 {
      margin: 10px 0 5px;
      font-size: 18px;
    }
    .item-card p { margin: 5px 0; color: #555; font-size: 14px; }
    .item-card button {
      padding: 10px 14px;
      border: none;
      border-radius: 25px;
      background: linear-gradient(135deg, #0072ff, #00c6ff);
      color: white;
      cursor: pointer;
      margin-top: 10px;
      font-weight: 500;
      transition: all 0.3s ease;
    }
    .item-card button:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .item-card button:disabled { background: #aaa; cursor: not-allowed; }

    /* ---------- ADD NEW ITEM CARD ---------- */
    .add-card {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      border: 2px dashed #0072ff;
      border-radius: 14px;
      background: rgba(0,114,255,0.05);
      cursor: pointer;
      transition: all 0.3s ease;
      height: 240px;
      animation: fadeInUp 1.2s ease;
    }
    .add-card:hover {
      background: rgba(0,198,255,0.15);
      transform: scale(1.05);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
    .add-card i {
      font-size: 40px;
      color: #0072ff;
      margin-bottom: 10px;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ---------- FOOTER ---------- */
    footer {
      text-align: center;
      padding: 20px;
      background: rgba(245,245,245,0.8);
      margin-top: auto;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
      position: sticky;
      bottom: 0;
      width: 100%;
      font-size: 14px;
      animation: fadeIn 1.2s ease;
    }
    .dark footer {
      background: rgba(30,30,30,0.9);
      color: #bbb;
    }

    /* ---------- RESPONSIVE ---------- */
    @media (max-width: 600px) {
      .search input { width: 160px; }
      header.topbar { flex-direction: column; gap: 10px; }
      h2 { font-size: 20px; }
    }
  </style>
</head>

<body>
  <!-- HEADER -->
  <header class="topbar">
    <div class="logo">üèè SportsHub</div>
    <div class="search">
      <input type="text" id="searchBox" placeholder="Search items or categories..." />
    </div>
    <div class="right">
      <div id="userArea">
        <a href="login.html" id="loginLink">Login</a>
      </div>
      <div class="menuBtn" id="menuBtn">‚ò∞</div>
      <button id="themeToggle">üåô</button>
    </div>
  </header>

  <!-- MENU -->
  <nav class="menu hidden" id="menu">
    <a href="index.html">Home</a>
    <a href="contact.html">Contact</a>
    <a href="about.html">About</a>
  </nav>

  <!-- MAIN CONTENT -->
  <main>
    <section id="categories">
      <h2>Sports Categories</h2>
      <div class="catlist" id="catList"></div>
    </section>

    <section id="featured">
      <h2>Top Selling Items</h2>
      <div class="grid" id="itemGrid"></div>
    </section>
  </main>

  <footer>
    <p>¬© 2025 SportsHub | Designed for learning purposes</p>
  </footer>

  <script>
  /* üåô DARK MODE */
  const themeToggle = document.getElementById("themeToggle");
  themeToggle.addEventListener("click", () => {
    document.body.classList.toggle("dark");
    localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark" : "");
  });
  if (localStorage.getItem("theme") === "dark") document.body.classList.add("dark");

  /* ‚ò∞ MENU TOGGLE */
  document.getElementById("menuBtn").addEventListener("click", () => {
    document.getElementById("menu").classList.toggle("hidden");
  });

  /* üîê AUTH CHECK */
  const username = localStorage.getItem("username");
  const role = localStorage.getItem("role");
  if (!username || !role) {
    window.location.href = "login.html";
  } else {
    document.getElementById("userArea").innerHTML = `
      <span>Hello, ${username}</span>
      <button onclick="logout()">Logout</button>
    `;
  }

  /* üëã LOGOUT */
  async function logout() {
    localStorage.clear();
    await fetch("http://localhost:3000/logout", { method: "POST" });
    window.location.href = "login.html";
  }

  /* üè∑Ô∏è LOAD CATEGORIES */
  async function loadCategories() {
    try {
      const res = await fetch("http://localhost:3000/api/categories", { cache: "no-store" });
      if (!res.ok) throw new Error("Failed to fetch categories");
      const data = await res.json();
      const catList = document.getElementById("catList");
      catList.innerHTML = data.map(c => `
        <div class="chip" onclick="filterItems(this, '${c}')">${c}</div>
      `).join("");
    } catch (err) {
      console.error("Error loading categories:", err);
      document.getElementById("catList").innerHTML = "<p style='color:red;'>Failed to load categories</p>";
    }
  }

  /* üõí LOAD ITEMS */
  async function loadItems(query = "") {
    try {
      const res = await fetch(`http://localhost:3000/api/items?search=${encodeURIComponent(query)}`, { cache: "no-store" });
      if (!res.ok) throw new Error("Failed to fetch items");
      const data = await res.json();
      const grid = document.getElementById("itemGrid");
      grid.innerHTML = "";

      if (!Array.isArray(data) || data.length === 0) {
        grid.innerHTML = `<p style="text-align:center;color:gray;">No items available.</p>`;
        if (role === "dealer") {
          grid.innerHTML += `
            <div class="add-card" onclick="addNewItem()">
              <i class="fa-solid fa-plus-circle"></i>
              <h3>Add New Item</h3>
            </div>
          `;
        }
        return;
      }

      data.forEach(item => {
        const card = document.createElement("div");
        card.className = "item-card";
        card.innerHTML = `
          <img src="${item.image_url || 'https://via.placeholder.com/200x150?text=No+Image'}" alt="${item.name}" />
          <h3>${item.name}</h3>
          <p><b>Category:</b> ${item.category}</p>
          <p><b>Price:</b> ‚Çπ${item.price}</p>
          <p><b>Stock:</b> ${item.quantity}</p>
          ${
            role === "customer"
              ? `<button ${item.quantity === 0 ? "disabled" : ""} onclick="redirectToPayment(${item.id}, '${item.name}', ${item.price})">
                   ${item.quantity === 0 ? "Out of Stock" : "Buy Now"}
                 </button>`
              : ""
          }
        `;
        grid.appendChild(card);
      });

      if (role === "dealer") {
        const addCard = document.createElement("div");
        addCard.className = "add-card";
        addCard.innerHTML = `
          <i class="fa-solid fa-plus-circle"></i>
          <h3>Add New Item</h3>
        `;
        addCard.onclick = addNewItem;
        grid.appendChild(addCard);
      }
    } catch (err) {
      console.error("Error loading items:", err);
      document.getElementById("itemGrid").innerHTML = "<p style='color:red;text-align:center;'>Failed to load items from DB.</p>";
    }
  }

  function filterItems(element, category) {
    document.querySelectorAll(".chip").forEach(c => c.classList.remove("active"));
    element.classList.add("active");
    document.getElementById("searchBox").value = category;
    loadItems(category);
  }

  document.getElementById("searchBox").addEventListener("input", (e) => {
    loadItems(e.target.value);
  });

  function addNewItem() {
    window.location.href = "dealer.html";
  }

  function redirectToPayment(id, name, price) {
    localStorage.setItem("purchaseItem", JSON.stringify({ id, name, price }));
    window.location.href = "payment.html";
  }

  loadCategories();
  loadItems();
  </script>
</body>
</html>
